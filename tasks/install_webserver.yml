---

- name: Add repository 
  apt_repository:
    repo: ppa:ondrej/php

- name: Install package
  apt: name={{ item }} update_cache=yes state=latest
  with_items:
    - php
    - php-cli
    - php-fpm
    - php-json
    - php-common
    - php-mysql
    - php-zip
    - php-gd
    - php-mbstring
    - php-curl
    - php-xml
    - php-pear
    - php-bcmath
    - mysql-server
    - nginx
    - pip

- name: Install composer
  shell: |
    php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
    php composer-setup.php
    php -r "unlink('composer-setup.php');"
    sudo mv composer.phar /usr/local/bin/composer

- name: Copy nginx default config files
  copy:
    src: ./default
    dest: /etc/nginx/sites-available/

- name: Copy nginx config files
  copy:
    src: ./nginx.conf
    dest: /etc/nginx/conf.d/

- name: Reload nginx
  service:
    name: nginx
    state: reloaded

- name: Start mysql
  service:
    name: mysql
    state: started 

- name: Start php-fpm8.3
  service:
    name: php8.3-fpm
    state: started
